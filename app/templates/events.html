{% extends "layout.html" %}
{% block content %}

<h2>{{ _('Upcoming Events') }}</h2>

{# —— 搜尋表單 —— #}
<form method="get" class="search-form">
  <input type="text" name="q"
         placeholder="{{ _('Search by keyword...') }}"
         value="{{ q }}" />

  <button type="submit">{{ _('Search') }}</button>
</form>

{# —— 活動列表 —— #}
{% if events %}
  <div class="event-grid">
    {% for event in events %}
      <div class="event-card">
        <h3>{{ event.title }}</h3>
        <p class="date">📅 {{ event.date[:10] }} {{ event.date[11:16] }}</p>
        <p>{{ event.description[:100] }}…</p>

        <div class="tags">
          {% for tag in event.tags %}
            <span class="tag">#{{ tag.name }}</span>
          {% endfor %}
        </div>

        <a class="btn"
           href="{{ url_for('main.event_detail', id=event.id) }}">
          {{ _('View Details') }}
        </a>

        {% if current_user.is_authenticated and current_user.id == event.created_by %}
          <div class="card-controls">
            <a href="{{ url_for('main.edit_event', id=event.id) }}">
              {{ _('Edit') }}
            </a> |
            <form action="{{ url_for('main.delete_event', id=event.id) }}"
                  method="POST" style="display:inline;">
              <input type="hidden"
                     name="csrf_token"
                     value="{{ csrf_token() }}">
              <button type="submit"
                      onclick="return confirm('{{ _('Delete this event?') }}')">
                {{ _('Delete') }}
              </button>
            </form>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <p>{{ _('No events found.') }}</p>
{% endif %}

<br>
{% if current_user.is_authenticated%}
  <a class="btn"
     href="{{ url_for('main.create_event') }}">
    {{ _('Create New Event') }}
  </a>
{% endif %}

{% endblock %}
